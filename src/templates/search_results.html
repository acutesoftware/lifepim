{% extends "layout.html" %}
{% block module_content %}
  <div>
    <strong>Query:</strong> {{ query or '' }}
    {% if project %}<span> | <strong>Project:</strong> {{ project }}</span>{% endif %}
    {% if route %}<span> | <strong>Tab:</strong> {{ route }}</span>{% endif %}
  </div>

  {% if not query %}
    <p>Enter a search term to see results.</p>
  {% else %}
    {% if results_primary %}
      <h4>Matches in current context</h4>
      <table class="search-results" border="1" cellpadding="5">
        <colgroup>
          <col class="search-col-table">
          <col class="search-col-match">
        </colgroup>
        <tr>
          <th>Table</th>
          <th>Match</th>
        </tr>
        {% for item in results_primary %}
        <tr class="link-draggable"
            {% if item.record_type %}data-record-type="{{ item.record_type }}" data-record-id="{{ item.id }}" data-record-title="{{ item.title or item.match_value or item.id }}"{% endif %}>
          <td class="table-col">{{ item.table }}</td>
          {% if item.match_field == 'content' %}
            <td class="search-match match-col" title="{{ item.match_value }}">
              <a class="search-match-title" href="{{ item.url }}">{{ item.title or item.id }}</a>
              <span class="search-match-sep"> - </span>
              <span class="search-match-text">{{ item.match_value }}</span>
            </td>
          {% else %}
            <td class="search-match match-col" title="{{ item.match_snippet }}">
              <a class="search-match-title" href="{{ item.url }}">{{ item.title or item.match_value or item.id }}</a>
              <span class="search-match-sep"> - </span>
              <span class="search-match-text">{{ item.match_field }}: {{ item.match_snippet }}</span>
            </td>
          {% endif %}
        </tr>
        {% endfor %}
      </table>
    {% endif %}

    {% if results_secondary %}
      <h4>Other matches</h4>
      <table class="search-results" border="1" cellpadding="5">
        <colgroup>
          <col class="search-col-table">
          <col class="search-col-match">
        </colgroup>
        <tr>
          <th>Table</th>
          <th>Match</th>
        </tr>
        {% for item in results_secondary %}
        <tr class="link-draggable"
            {% if item.record_type %}data-record-type="{{ item.record_type }}" data-record-id="{{ item.id }}" data-record-title="{{ item.title or item.match_value or item.id }}"{% endif %}>
          <td class="table-col">{{ item.table }}</td>
          {% if item.match_field == 'content' %}
            <td class="search-match match-col" title="{{ item.match_value }}">
              <a class="search-match-title" href="{{ item.url }}">{{ item.title or item.id }}</a>
              <span class="search-match-sep"> - </span>
              <span class="search-match-text">{{ item.match_value }}</span>
            </td>
          {% else %}
            <td class="search-match match-col" title="{{ item.match_snippet }}">
              <a class="search-match-title" href="{{ item.url }}">{{ item.title or item.match_value or item.id }}</a>
              <span class="search-match-sep"> - </span>
              <span class="search-match-text">{{ item.match_field }}: {{ item.match_snippet }}</span>
            </td>
          {% endif %}
        </tr>
        {% endfor %}
      </table>
    {% endif %}

    {% if query and not results_primary and not results_secondary %}
      <p>No matches found.</p>
    {% endif %}
  {% endif %}
{% endblock %}
