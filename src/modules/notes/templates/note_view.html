{% extends 'layout.html' %}
{% block module_content %}
  <div class="note-view">
    <div>
      {% set btn_style = "display:inline-block;padding:2px 8px;border:1px solid #999;border-radius:4px;text-decoration:none;margin-right:4px;" %}
      <a href="{{ url_for('notes.view_note_route', note_id=note.id, format='text') }}"
         style="{{ btn_style }}{% if render_mode == 'text' %}background:#ddd;font-weight:bold;{% endif %}">Text</a>
      <a href="{{ url_for('notes.view_note_route', note_id=note.id, format='markdown') }}"
         style="{{ btn_style }}{% if render_mode == 'markdown' %}background:#ddd;font-weight:bold;{% endif %}">Markdown</a>
      <a href="{{ url_for('notes.view_note_route', note_id=note.id, format='hex') }}"
         style="{{ btn_style }}{% if render_mode == 'hex' %}background:#ddd;font-weight:bold;{% endif %}">Hex</a>
    </div>
    <h4>{{ note.file_name }}</h4>

    <table border="1" cellpadding="4">
      <tr><th>File</th><td>{{ note.file_name }}</td></tr>
      <tr><th>Path</th><td>{{ note.path }}</td></tr>
      <tr><th>Folder ID</th><td>{{ note.folder_id }}</td></tr>
      <tr><th>Size</th><td>{{ note.size }}</td></tr>
      <tr><th>Date Modified</th><td>{{ note.date_modified }}</td></tr>
      <tr><th>Project</th><td>{{ note.project }}</td></tr>
      <tr><th>Derived Project</th><td>{{ note.derived_project }}</td></tr>
      <tr><th>Updated</th><td>{{ note.updated.strftime('%Y-%m-%d %H:%M') }}</td></tr>
    </table>

    {% if not file_exists %}
      <p>File not found: {{ note_path }}</p>
    {% else %}
      {% if render_mode == 'markdown' %}
        <div>{{ content_html_rendered|safe }}</div>
      {% elif render_mode == 'hex' %}
        <div style="display:flex; gap:12px; margin-top:8px;">
          <div style="flex:1; border:1px solid #ccc; padding:6px;">
            {% for row in hex_rows %}
              {{ row.hex }}{% if not loop.last %}<br>{% endif %}
            {% endfor %}
          </div>
          <div style="flex:1; border:1px solid #ccc; padding:6px;">
            {% for row in hex_rows %}
              {{ row.ascii }}{% if not loop.last %}<br>{% endif %}
            {% endfor %}
          </div>
        </div>
      {% else %}
        <pre style="white-space: pre-wrap; font-family: inherit;">{{ note_text }}</pre>
      {% endif %}
    {% endif %}
    <p><a href="{{ url_for('notes.edit_note_route', note_id=note.id) }}">Edit</a></p>
  </div>
  {% set link_record_type = "note" %}
  {% set link_record_id = note.id %}
  {% set link_record_title = note.file_name %}
  {% set link_context_type = "note_detail" %}
  {% set link_mode = "outgoing" %}
  {% include "widgets/links_drawer.html" %}
{% endblock %}
